name: End-to-end tests
on: [push]

jobs:
    cypress-e2e:
        runs-on: ubuntu-latest
        container: cypress/browsers:latest

        steps:
            - uses: actions/checkout@v2
            - name: Run Cypress tests
              uses: cypress-io/github-action@v2
              with:
                  command: npm run cy:tests-with-allure-headless

            - name: Build test report
              uses: simple-elf/allure-report-action@master
              if: always()
              id: allure-report
              with:
                   allure_results: build/allure-results
                   gh_pages: gh-pages
                   allure_report: allure-report
                   allure_history: allure-history
                
            - name: Deploy report to Github Pages
              if: always()
              uses: peaceiris/actions-gh-pages@v2
              env:
                    PERSONAL_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                    PUBLISH_BRANCH: gh-pages
                    PUBLISH_DIR: allure-history